<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accetta Invito - EduNet19</title>
  
  <!-- Styles -->
  <link rel="stylesheet" href="../../styles.min.css">
  <link rel="stylesheet" href="../../css/components/accept-invite.min.css">
  
  <!-- Preconnect per performance -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
  
  <!-- Preference Loader (Must be in HEAD to prevent FOUC) -->
  <script src="../../js/utils/preference-loader.min.js"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../../config.min.js"></script>
  <script src="../../supabase-client.min.js"></script>
</head>
<body>
  
  <div class="invite-container">
    
    <!-- Loading State -->
    <div id="loading-state" class="invite-card">
      <div class="invite-icon">
        <i class="fas fa-spinner fa-spin"></i>
      </div>
      <h1>Verifica invito...</h1>
      <p>Attendere prego</p>
    </div>

    <!-- Valid Invite State -->
    <div id="valid-invite-state" class="invite-card" style="display: none;">
      <div class="invite-icon success">
        <i class="fas fa-envelope-open"></i>
      </div>
      <h1>Invito Amministratore</h1>
      <p class="invite-message">Sei stato invitato a diventare amministratore di:</p>
      
      <div class="institute-info">
        <div class="institute-avatar" id="institute-avatar">
          <i class="fas fa-school"></i>
        </div>
        <div class="institute-details">
          <h2 id="institute-name">Nome Istituto</h2>
          <p id="institute-type">Tipo Istituto</p>
        </div>
      </div>
      
      <div class="role-info">
        <span class="role-label">Ruolo assegnato:</span>
        <span class="role-badge" id="invite-role">Amministratore</span>
      </div>
      
      <div class="invite-actions">
        <button class="btn-primary" id="accept-btn" onclick="acceptInvite()">
          <i class="fas fa-check"></i>
          Accetta Invito
        </button>
        <button class="btn-secondary" onclick="declineInvite()">
          <i class="fas fa-times"></i>
          Rifiuta
        </button>
      </div>
      
      <p class="invite-note">
        <i class="fas fa-info-circle"></i>
        Accettando diventerai amministratore dell'istituto e potrai gestire contenuti e profilo.
      </p>
    </div>

    <!-- Invalid Invite State -->
    <div id="invalid-invite-state" class="invite-card" style="display: none;">
      <div class="invite-icon error">
        <i class="fas fa-times-circle"></i>
      </div>
      <h1>Invito Non Valido</h1>
      <p id="error-message">L'invito potrebbe essere scaduto o gi√† utilizzato.</p>
      
      <div class="invite-actions">
        <button class="btn-primary" onclick="window.location.href='../../homepage.html'">
          <i class="fas fa-home"></i>
          Torna alla Homepage
        </button>
      </div>
    </div>

    <!-- Success State -->
    <div id="success-state" class="invite-card" style="display: none;">
      <div class="invite-icon success">
        <i class="fas fa-check-circle"></i>
      </div>
      <h1>Invito Accettato!</h1>
      <p>Ora sei amministratore dell'istituto.</p>
      
      <div class="invite-actions">
        <button class="btn-primary" onclick="window.location.href='../../homepage.html'">
          <i class="fas fa-home"></i>
          Vai alla Homepage
        </button>
        <button class="btn-secondary" onclick="window.location.href=window.AppConfig.getPageUrl('pages/admin/manage-admins.html')">
          <i class="fas fa-users"></i>
          Gestisci Amministratori
        </button>
      </div>
    </div>

  </div>

  <!-- Scripts -->
  <script src="../../js/auth/auth.min.js"></script>
  <script src="../../js/admin/admin-manager.min.js"></script>
  <script src="../../js/admin/accept-invite.min.js"></script>
  
</body>
</html>
