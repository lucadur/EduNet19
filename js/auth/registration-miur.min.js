!function(){"use strict";let e=null;function n(){const e=document.getElementById("searchMiurBtn"),n=document.getElementById("instituteCode");e&&n?(console.log("‚úÖ MIUR Registration - Initialized"),e.addEventListener("click",t),n.addEventListener("keypress",function(e){"Enter"===e.key&&(e.preventDefault(),t())}),n.addEventListener("input",function(e){e.target.value=e.target.value.toUpperCase()})):console.log("‚ö†Ô∏è Form registrazione istituto non trovato")}async function t(){const n=document.getElementById("instituteCode"),t=document.getElementById("searchMiurBtn"),l=document.getElementById("instituteCode-error"),y=document.getElementById("instituteCode-success"),v=n.value.trim();if(v){t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin"></i>';try{if(console.log("üîç Ricerca codice:",v),e=await window.miurAutocomplete.findSchoolByCode(v),e&&e.error){const n=e.schoolType||"Non specificato";return r(l,e.message||"Tipo di scuola non supportato"),u(y),p(n),void a()}if(!e)return r(l,"Codice non trovato nel database MIUR"),u(y),void o();const n=window.miurAutocomplete.validateData(e);if(!n.isValid)return r(l,"Dati non validi: "+n.errors.join(", ")),void u(y);c(l),d(y,"Istituto trovato nel database MIUR!"),i(e),s(e),n.warnings.length>0&&(console.warn("‚ö†Ô∏è Warning:",n.warnings),m(n.warnings))}catch(e){console.error("‚ùå Errore ricerca MIUR:",e),r(l,"Errore durante la ricerca. Riprova."),u(y)}finally{t.disabled=!1,t.innerHTML='<i class="fas fa-search"></i>'}}else r(l,"Inserisci un codice meccanografico")}function i(e){const n=document.getElementById("miurPreview"),t=document.getElementById("miurPreviewContent");if(!n||!t)return;const i=`\n      <div class="miur-data-row">\n        <span class="miur-label">Nome:</span>\n        <span class="miur-value">${e.institute_name||"-"}</span>\n      </div>\n      <div class="miur-data-row">\n        <span class="miur-label">Tipo:</span>\n        <span class="miur-value">${e.institute_type||"-"}</span>\n      </div>\n      <div class="miur-data-row">\n        <span class="miur-label">Citt√†:</span>\n        <span class="miur-value">${e.city||"-"} (${e.province||"-"})</span>\n      </div>\n      ${e.email?`\n      <div class="miur-data-row">\n        <span class="miur-label">Email:</span>\n        <span class="miur-value">${e.email}</span>\n      </div>\n      `:""}\n      ${e.website?`\n      <div class="miur-data-row">\n        <span class="miur-label">Sito:</span>\n        <span class="miur-value">${e.website}</span>\n      </div>\n      `:""}\n      ${e.address?`\n      <div class="miur-data-row">\n        <span class="miur-label">Indirizzo:</span>\n        <span class="miur-value">${e.address}</span>\n      </div>\n      `:""}\n    `;t.innerHTML=i,n.style.display="block"}function s(e){const n=document.getElementById("instituteName");n&&e.institute_name&&(n.value=e.institute_name,n.readOnly=!0);const t=document.getElementById("instituteType");if(t&&e.institute_type){const n=e.institute_type;let i=Array.from(t.options).some(e=>e.value===n);if(i)t.value=n;else{const e=Array.from(t.options).find(e=>e.value.toLowerCase().includes(n.toLowerCase())||n.toLowerCase().includes(e.value.toLowerCase()));e?t.value=e.value:console.warn(`‚ö†Ô∏è Tipo istituto "${n}" non trovato nelle opzioni`)}let s=document.getElementById("institute-type-hidden");s||(s=document.createElement("input"),s.type="hidden",s.id="institute-type-hidden",s.name="instituteType",t.parentNode.appendChild(s)),s.value=t.value||n,t.disabled=!0}const i=document.getElementById("instituteEmail");i&&!i.value&&setTimeout(()=>{i.focus(),i.scrollIntoView({behavior:"smooth",block:"center"})},500);const s=document.getElementById("miurEmailGroup"),o=document.getElementById("miurEmailDisplay");e.email&&s&&o?(o.value=e.email,s.style.display="block",console.log("üìß Email MIUR mostrata:",e.email)):s&&(s.style.display="none"),l("institute-email-hidden",e.email),l("institute-address-hidden",e.address),l("institute-city-hidden",e.city),l("institute-province-hidden",e.province),l("institute-website-hidden",e.website),l("institute-code-hidden",e.codice_scuola),console.log("‚úÖ Form compilato con dati MIUR")}function o(){a();const n=document.getElementById("miurPreview");n&&(n.style.display="none",n.classList.remove("error-state"));const t=document.getElementById("miurEmailGroup");t&&(t.style.display="none"),e=null}function a(){const n=document.getElementById("instituteName"),t=document.getElementById("instituteType"),i=document.getElementById("miurEmailDisplay");n&&(n.value="",n.readOnly=!1),t&&(t.value="",t.disabled=!1,t.style.backgroundColor=""),i&&(i.value=""),e=null}function l(e,n){const t=document.getElementById(e);t&&(t.value=n||"")}function r(e,n){e&&(e.textContent=n,e.style.display="block")}function c(e){e&&(e.style.display="none")}function d(e,n){e&&(e.querySelector("span").textContent=n,e.style.display="flex")}function u(e){e&&(e.style.display="none")}function m(e){const n=document.getElementById("miurPreview");if(!n)return;const t=`\n      <div class="miur-warnings">\n        <i class="fas fa-exclamation-triangle"></i>\n        <div>\n          <strong>Attenzione:</strong>\n          <ul>\n            ${e.map(e=>`<li>${e}</li>`).join("")}\n          </ul>\n        </div>\n      </div>\n    `;n.insertAdjacentHTML("beforeend",t)}function p(e){const n=document.getElementById("miurPreview"),t=document.getElementById("miurPreviewContent");if(!n||!t)return;const i=`\n      <div class="miur-school-type-error">\n        <div class="error-icon">\n          <i class="fas fa-school"></i>\n          <i class="fas fa-times-circle error-badge"></i>\n        </div>\n        <h4>Tipo di scuola non supportato</h4>\n        <p class="school-type-detected">Tipo rilevato: <strong>${e||"Non specificato"}</strong></p>\n        <p class="school-type-message">\n          Al momento EduNet19 supporta solo la registrazione di:\n        </p>\n        <ul class="supported-types">\n          <li><i class="fas fa-check"></i> Scuole Medie (Secondaria di I Grado)</li>\n          <li><i class="fas fa-check"></i> Scuole Superiori (Licei, Istituti Tecnici, Professionali)</li>\n          <li><i class="fas fa-check"></i> Universit√† e Politecnici</li>\n        </ul>\n        <p class="school-type-hint">\n          <i class="fas fa-info-circle"></i>\n          Se ritieni che questo sia un errore, contattaci all'indirizzo supporto@edunet19.it\n        </p>\n      </div>\n    `;t.innerHTML=i,n.style.display="block",n.classList.add("error-state")}document.addEventListener("DOMContentLoaded",function(){n()}),window.getMiurRegistrationData=function(){return e},console.log("‚úÖ Registration MIUR - Script loaded")}();