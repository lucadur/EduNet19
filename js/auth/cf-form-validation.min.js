class CFFormValidation{constructor(){this.debounceTimer=null,this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setupListeners()):this.setupListeners()}setupListeners(){const i=document.getElementById("codiceFiscale"),e=document.getElementById("firstName"),a=document.getElementById("lastName"),t=document.getElementById("birthDate");i&&(i.addEventListener("input",i=>{i.target.value=i.target.value.toUpperCase(),this.debounceValidation()}),i.addEventListener("blur",()=>this.validateCF()),[e,a,t].forEach(i=>{i&&(i.addEventListener("change",()=>this.debounceValidation()),i.addEventListener("blur",()=>this.debounceValidation()))}))}debounceValidation(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>this.validateCF(),500)}validateCF(){const i=document.getElementById("codiceFiscale"),e=document.getElementById("firstName"),a=document.getElementById("lastName"),t=document.getElementById("birthDate"),n=document.getElementById("codiceFiscale-error"),o=document.getElementById("codiceFiscale-info");if(!i||!n)return;const s=i.value.trim().toUpperCase(),l=e?.value.trim()||"",c=a?.value.trim()||"",r=t?.value||"";if(i.classList.remove("is-valid","is-invalid"),n.innerHTML="",n.style.display="none",!s)return void(o&&(o.innerHTML='\n                    <i class="fas fa-shield-alt"></i>\n                    Il codice fiscale viene utilizzato per verificare la tua identità e la tua età reale.\n                ',o.style.display="block"));if(!window.codiceFiscaleValidator)return void console.warn("CF Validator not loaded");const d=window.codiceFiscaleValidator.validateFormat(s);if(!d.valid)return void this.showError(i,n,d.error,"format");if(!l||!c||!r)return window.codiceFiscaleValidator.validateCheckChar(s)?(i.classList.add("is-valid"),void(o&&(o.innerHTML='\n                    <i class="fas fa-check-circle" style="color: #10b981;"></i>\n                    Formato codice fiscale valido. Completa gli altri campi per la verifica completa.\n                ',o.style.display="block"))):void this.showError(i,n,"Il codice fiscale contiene un errore. Verifica di averlo inserito correttamente.","checksum");const m=window.codiceFiscaleValidator.validate(s,l,c,r);if(m.valid){if(i.classList.add("is-valid"),i.classList.remove("is-invalid"),n.style.display="none",o){const i=m.age?` (${m.age} anni)`:"";o.innerHTML=`\n                <i class="fas fa-check-circle" style="color: #10b981;"></i>\n                <strong style="color: #10b981;">Codice fiscale verificato!</strong> I dati corrispondono${i}.\n            `,o.style.display="block"}}else this.showDetailedErrors(i,n,m.errors,l,c,r)}showError(i,e,a){i.classList.add("is-invalid"),i.classList.remove("is-valid"),e.innerHTML=`\n            <i class="fas fa-exclamation-circle"></i>\n            ${a}\n        `,e.style.display="block"}showDetailedErrors(i,e,a,t,n,o){i.classList.add("is-invalid"),i.classList.remove("is-valid");const s=a.map(i=>{if(i.includes("cognome"))return`<li><i class="fas fa-user"></i> <strong>Cognome non corrispondente:</strong> Il cognome "${n}" non corrisponde a quello codificato nel CF. Verifica di aver scritto correttamente sia il cognome che il codice fiscale.</li>`;if(i.includes("nome"))return`<li><i class="fas fa-user"></i> <strong>Nome non corrispondente:</strong> Il nome "${t}" non corrisponde a quello codificato nel CF. Verifica di aver scritto correttamente sia il nome che il codice fiscale.</li>`;if(i.includes("data di nascita")){const i=o?new Date(o).toLocaleDateString("it-IT"):"N/A";return`<li><i class="fas fa-calendar-alt"></i> <strong>Data di nascita non corrispondente:</strong> La data ${i} non corrisponde a quella codificata nel CF. Verifica la data di nascita inserita.</li>`}return i.includes("controllo")?'<li><i class="fas fa-exclamation-triangle"></i> <strong>Codice fiscale non valido:</strong> Il carattere di controllo non è corretto. Verifica di aver copiato correttamente il codice fiscale.</li>':`<li><i class="fas fa-times-circle"></i> ${i}</li>`});e.innerHTML=`\n            <div class="cf-validation-errors">\n                <div class="cf-error-header">\n                    <i class="fas fa-exclamation-triangle"></i>\n                    <span>⚠️ ATTENZIONE: I dati inseriti NON corrispondono al Codice Fiscale</span>\n                </div>\n                <div class="cf-error-description">\n                    Il codice fiscale contiene informazioni su nome, cognome e data di nascita. \n                    I dati che hai inserito non coincidono con quelli codificati nel CF.\n                </div>\n                <ul class="cf-error-list">\n                    ${s.join("")}\n                </ul>\n                <div class="cf-error-suggestion">\n                    <i class="fas fa-lightbulb"></i>\n                    <div>\n                        <strong>Come risolvere:</strong>\n                        <ul>\n                            <li>Verifica che nome e cognome siano scritti esattamente come sul documento d'identità</li>\n                            <li>Controlla che la data di nascita sia corretta</li>\n                            <li>Assicurati di aver copiato il codice fiscale senza errori</li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        `,e.style.display="block",e.scrollIntoView({behavior:"smooth",block:"center"})}}window.cfFormValidation=new CFFormValidation;