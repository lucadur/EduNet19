class EduNetValidation{constructor(){this.validators={email:this.validateEmail.bind(this),password:this.validatePassword.bind(this),instituteName:this.validateInstituteName.bind(this),instituteType:this.validateInstituteType.bind(this),firstName:this.validateFirstName.bind(this),lastName:this.validateLastName.bind(this),confirmPassword:this.validateConfirmPassword.bind(this),phone:this.validatePhone.bind(this),website:this.validateWebsite.bind(this),pecEmail:this.validatePecEmail.bind(this)}}sanitizeInput(t){return"string"!=typeof t?t:t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;").replace(/javascript:/gi,"").replace(/on\w+=/gi,"")}validateForm(t){const e=t.querySelectorAll("[data-validate]");let i=!0;return e.forEach(t=>{const e=t.getAttribute("data-validate"),s=t.value;if(this.validators[e]){const a=this.validators[e](s);a?this.clearFieldError(t):(i=!1,this.showFieldError(t,`${e} non valido`))}}),i}init(){this.setupRealTimeValidation()}initializeValidation(){return this.init()}validateEmail(t){const e=[];if(!t||""===t.trim())return e.push("Email è obbligatoria"),{isValid:!1,errors:e};const i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;i.test(t)||e.push("Formato email non valido");const s=["gmail.com","yahoo.com","hotmail.com","outlook.com","libero.it","alice.it","tin.it"],a=t.split("@")[1];if(a&&!s.includes(a.toLowerCase())){const t=this.suggestEmailCorrection(a);t.length>0&&e.push(`Forse intendevi: ${t.join(", ")}`)}return{isValid:0===e.length,errors:e}}validatePassword(t){const e=[];if(!t)return e.push("Password è obbligatoria"),{isValid:!1,errors:e};t.length<8&&e.push("Password deve essere di almeno 8 caratteri"),/[A-Z]/.test(t)||e.push("Password deve contenere almeno una lettera maiuscola"),/[a-z]/.test(t)||e.push("Password deve contenere almeno una lettera minuscola"),/\d/.test(t)||e.push("Password deve contenere almeno un numero"),/[!@#$%^&*(),.?":{}|<>]/.test(t)||e.push("Password deve contenere almeno un carattere speciale");const i=["password","12345678","qwerty123","admin123"];return i.includes(t.toLowerCase())&&e.push("Password troppo comune, scegline una più sicura"),{isValid:0===e.length,errors:e}}validateConfirmPassword(t,e){const i=[];return e?(t!==e&&i.push("Le password non coincidono"),{isValid:0===i.length,errors:i}):(i.push("Conferma password è obbligatoria"),{isValid:!1,errors:i})}validateInstituteName(t){const e=[];return t&&""!==t.trim()?(t.length<3&&e.push("Nome istituto deve essere di almeno 3 caratteri"),t.length>255&&e.push("Nome istituto troppo lungo (massimo 255 caratteri)"),/^[a-zA-ZÀ-ÿ0-9\s\-\.\,\'\"\(\)\/\&\:\;«»°\*]+$/.test(t)||e.push("Nome istituto contiene caratteri non validi"),{isValid:0===e.length,errors:e}):(e.push("Nome istituto è obbligatorio"),{isValid:!1,errors:e})}validateInstituteType(t){const e=[];if(!t||""===t.trim())return e.push("Tipo istituto è obbligatorio"),{isValid:!1,errors:e};const i=["Scuola Secondaria di I Grado","Scuola Secondaria di II Grado","Liceo","Istituto Tecnico","Istituto Professionale","ITS","Università"];return i.includes(t)||e.push("Tipo istituto non valido"),{isValid:0===e.length,errors:e}}validateFirstName(t){const e=[];return t&&""!==t.trim()?(t.length<2&&e.push("Nome deve essere di almeno 2 caratteri"),t.length>100&&e.push("Nome troppo lungo (massimo 100 caratteri)"),/^[a-zA-ZÀ-ÿ\s\-\']+$/.test(t)||e.push("Nome contiene caratteri non validi"),{isValid:0===e.length,errors:e}):(e.push("Nome è obbligatorio"),{isValid:!1,errors:e})}validateLastName(t){const e=[];return t&&""!==t.trim()?(t.length<2&&e.push("Cognome deve essere di almeno 2 caratteri"),t.length>100&&e.push("Cognome troppo lungo (massimo 100 caratteri)"),/^[a-zA-ZÀ-ÿ\s\-\']+$/.test(t)||e.push("Cognome contiene caratteri non validi"),{isValid:0===e.length,errors:e}):(e.push("Cognome è obbligatorio"),{isValid:!1,errors:e})}validatePhone(t){const e=[];if(!t)return{isValid:!0,errors:e};const i=t.replace(/[\s\-\(\)\.]/g,"");return/^\+?[0-9]{8,15}$/.test(i)||e.push("Numero di telefono non valido"),{isValid:0===e.length,errors:e}}validateWebsite(t){const e=[];if(!t)return{isValid:!0,errors:e};try{const i=new URL(t.startsWith("http")?t:`https://${t}`);["http:","https:"].includes(i.protocol)||e.push("URL non valido")}catch{e.push("URL non valido")}return{isValid:0===e.length,errors:e}}validatePecEmail(t){const e=[];if(!t)return{isValid:!0,errors:e};const i=this.validateEmail(t);return i.isValid||e.push(...i.errors),t.includes(".pec.")||t.endsWith(".pec.it")||e.push("Email PEC deve avere un dominio PEC valido"),{isValid:0===e.length,errors:e}}validateLoginForm(t){const e={email:this.validateEmail(t.email),password:{isValid:!!t.password,errors:t.password?[]:["Password è obbligatoria"]}},i=Object.values(e).every(t=>t.isValid);return{isValid:i,results:e}}validateInstituteRegistrationForm(t){const e={instituteName:this.validateInstituteName(t.instituteName),instituteType:this.validateInstituteType(t.instituteType),email:this.validateEmail(t.email),password:this.validatePassword(t.password),confirmPassword:this.validateConfirmPassword(t.password,t.confirmPassword)},i=Object.values(e).every(t=>t.isValid);return{isValid:i,results:e}}validatePrivateUserRegistrationForm(t){const e={firstName:this.validateFirstName(t.firstName),lastName:this.validateLastName(t.lastName),email:this.validateEmail(t.email),password:this.validatePassword(t.password),confirmPassword:this.validateConfirmPassword(t.password,t.confirmPassword)},i=Object.values(e).every(t=>t.isValid);return{isValid:i,results:e}}setupRealTimeValidation(){document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll("input[data-validate]");t.forEach(t=>{t.addEventListener("blur",t=>this.validateField(t.target)),t.addEventListener("input",t=>this.clearFieldErrors(t.target))})})}validateField(t){const e=t.getAttribute("data-validate"),i=t.value;if(!this.validators[e])return;let s;if("confirmPassword"===e){const a=t.form.querySelector('input[data-validate="password"]');s=this.validators[e](a?.value,i)}else s=this.validators[e](i);return this.displayFieldValidation(t,s),s}displayFieldValidation(t,e){if(this.clearFieldErrors(t),!e.isValid&&e.errors.length>0){t.classList.add("is-invalid"),t.classList.remove("is-valid");const i=t.getAttribute("aria-describedby"),s=i?document.getElementById(i):null;s&&(s.textContent=e.errors.join(", "),s.style.display="block")}else""!==t.value.trim()&&(t.classList.add("is-valid"),t.classList.remove("is-invalid"))}clearFieldErrors(t){t.classList.remove("is-invalid","is-valid");const e=t.getAttribute("aria-describedby"),i=e?document.getElementById(e):null;i&&(i.textContent="",i.style.display="none")}suggestEmailCorrection(t){const e=["gmail.com","yahoo.com","hotmail.com","outlook.com"],i=[];return e.forEach(e=>{this.levenshteinDistance(t.toLowerCase(),e)<=2&&i.push(e)}),i}levenshteinDistance(t,e){const i=[];for(let t=0;t<=e.length;t++)i[t]=[t];for(let e=0;e<=t.length;e++)i[0][e]=e;for(let s=1;s<=e.length;s++)for(let a=1;a<=t.length;a++)e.charAt(s-1)===t.charAt(a-1)?i[s][a]=i[s-1][a-1]:i[s][a]=Math.min(i[s-1][a-1]+1,i[s][a-1]+1,i[s-1][a]+1);return i[e.length][t.length]}validateForm(t,e){switch(t){case"login":return this.validateLoginForm(e);case"instituteRegistration":return this.validateInstituteRegistrationForm(e);case"privateUserRegistration":return this.validatePrivateUserRegistrationForm(e);default:return{isValid:!1,results:{}}}}validateInstituteForm(){const t=document.getElementById("instituteForm");if(!t)return!1;const e=new FormData(t),i={instituteName:e.get("instituteName"),instituteType:e.get("instituteType"),email:e.get("email"),password:e.get("password"),confirmPassword:e.get("confirmPassword")},s=this.validateInstituteRegistrationForm(i);return s.isValid}validatePasswordReset(t){const e=[];return t.newPassword?this.validators.password(t.newPassword)||e.push("La password deve contenere almeno 8 caratteri, una maiuscola, una minuscola, un numero e un carattere speciale"):e.push("La nuova password è obbligatoria"),t.confirmPassword?t.newPassword!==t.confirmPassword&&e.push("Le password non coincidono"):e.push("La conferma password è obbligatoria"),{isValid:0===e.length,errors:e}}}window.eduNetValidation=new EduNetValidation;