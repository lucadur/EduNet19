class ModernFilters{constructor(){this.filterState={tab:"all",contentTypes:["post","news","project","methodology","event","educational_experience","collaboration"],period:"all",instituteTypes:[],sort:"recent",view:"grid"},this.init()}init(){console.log("üéõÔ∏è Inizializzazione Modern Filters..."),this.moveMenuToBody(),this.setupPrimaryTabs(),this.setupQuickFilterDropdown(),this.setupSortDropdown(),this.setupViewMode(),this.setupFilterPills(),this.setupActionButtons(),this.updateActiveFiltersDisplay()}setupPrimaryTabs(){const e=document.querySelectorAll(".primary-tab");e.forEach(t=>{t.addEventListener("click",()=>{e.forEach(e=>{e.classList.remove("active"),e.setAttribute("aria-selected","false")}),t.classList.add("active"),t.setAttribute("aria-selected","true"),this.filterState.tab=t.dataset.feed,this.switchSection(this.filterState.tab),this.applyFilters()})})}switchSection(e){const t=document.getElementById("feed-content"),o=document.getElementById("eduMatchSection"),n=document.getElementById("discoverSection"),i=document.getElementById("saved-posts-section");n&&(n.style.display="none"),i&&(i.classList.add("hidden"),i.style.display="none"),"discover"===e?(t&&(t.style.display="none"),o&&(o.style.display="none"),n&&(n.style.display="block"),this.hidePostCreationBox()):"saved"===e?(i&&(i.classList.remove("hidden"),i.style.display="block",i.style.order="-1"),t&&(t.style.order="1",t.style.display="block"),o&&(o.style.display="none"),this.addSavedFeedSeparator(),this.hidePostCreationBox()):(t&&(t.style.display="block",t.style.order=""),o&&o.style.removeProperty("display"),this.showPostCreationBox())}hidePostCreationBox(){const e=document.querySelector(".post-creation-box");e&&(e.style.display="none")}showPostCreationBox(){const e=document.querySelector(".post-creation-box");e&&(e.style.display="")}addSavedFeedSeparator(){const e=document.getElementById("feed-content");if(!e)return;const t=document.getElementById("saved-feed-separator");t&&t.remove();const o=document.createElement("div");o.id="saved-feed-separator",o.className="saved-feed-separator",o.innerHTML='\n      <div class="separator-line"></div>\n      <div class="separator-content">\n        <i class="fas fa-stream"></i>\n        <span>Feed Generale</span>\n      </div>\n      <div class="separator-line"></div>\n    ',e.parentElement.insertBefore(o,e)}setupQuickFilterDropdown(){const e=document.getElementById("quickFilterToggle"),t=document.getElementById("quickFilterMenu"),o=this.createOverlay();e&&t&&(e.addEventListener("click",e=>{e.stopPropagation();const o=t.classList.contains("open");o?this.closeFilterDropdown():this.openFilterDropdown()}),o.addEventListener("click",()=>{this.closeFilterDropdown(),this.closeSortDropdown()}),t.addEventListener("click",e=>{e.stopPropagation()}))}openFilterDropdown(){const e=document.getElementById("quickFilterToggle"),t=document.getElementById("quickFilterMenu"),o=document.querySelector(".filters-overlay");console.log("üéõÔ∏è Opening filter dropdown..."),t?(document.body.style.overflow="hidden",t.style.cssText="\n      display: block !important;\n      position: fixed !important;\n      top: 50% !important;\n      left: 50% !important;\n      transform: translate(-50%, -50%) !important;\n      z-index: 999999 !important;\n      opacity: 1 !important;\n      visibility: visible !important;\n    ",window.innerWidth<=480&&(t.style.cssText="\n        display: block !important;\n        position: fixed !important;\n        bottom: 0 !important;\n        left: 0 !important;\n        right: 0 !important;\n        top: auto !important;\n        transform: none !important;\n        z-index: 999999 !important;\n        opacity: 1 !important;\n        visibility: visible !important;\n        max-height: 90vh !important;\n        border-radius: 16px 16px 0 0 !important;\n        padding-bottom: 100px !important;\n      "),t.classList.add("open"),e?.classList.add("open","active"),o?.classList.add("active"),console.log("‚úÖ Filter dropdown opened"),this.updateLiveCounter()):console.error("‚ùå Filter menu not found!")}closeFilterDropdown(){const e=document.getElementById("quickFilterToggle"),t=document.getElementById("quickFilterMenu"),o=document.querySelector(".filters-overlay");document.body.style.overflow="",t&&(t.style.cssText="",t.classList.remove("open")),e?.classList.remove("open","active"),o?.classList.remove("active")}setupSortDropdown(){const e=document.getElementById("sortToggle"),t=document.getElementById("sortMenu"),o=t?.querySelectorAll(".sort-option");e&&t&&(e.addEventListener("click",e=>{e.stopPropagation();const o=t.classList.contains("open");this.closeFilterDropdown(),o?this.closeSortDropdown():this.openSortDropdown()}),o?.forEach(t=>{t.addEventListener("click",()=>{o.forEach(e=>e.classList.remove("active")),t.classList.add("active");const n=e.querySelector(".sort-label"),i=t.querySelector("span").textContent;n.textContent=i,this.filterState.sort=t.dataset.sort,this.closeSortDropdown(),this.applyFilters()})}))}openSortDropdown(){const e=document.getElementById("sortToggle"),t=document.getElementById("sortMenu");t&&(t.style.cssText="\n        display: block !important;\n        z-index: 999999 !important;\n      ",t.classList.add("open")),e?.classList.add("open"),setTimeout(()=>{document.addEventListener("click",this.handleOutsideClick)},10)}handleOutsideClick=e=>{const t=document.getElementById("sortMenu"),o=document.getElementById("sortToggle");!t||t.contains(e.target)||o?.contains(e.target)||this.closeSortDropdown()};closeSortDropdown(){const e=document.getElementById("sortToggle"),t=document.getElementById("sortMenu");t&&(t.style.cssText="",t.classList.remove("open")),e?.classList.remove("open"),document.removeEventListener("click",this.handleOutsideClick)}setupViewMode(){const e=document.querySelectorAll(".view-mode-btn");e?.forEach(t=>{t.addEventListener("click",()=>{e.forEach(e=>e.classList.remove("active")),t.classList.add("active"),this.filterState.view=t.dataset.view,this.applyViewMode()})})}applyViewMode(){const e=document.getElementById("feed-content");"list"===this.filterState.view?(e?.classList.add("list-view"),e?.classList.remove("grid-view")):(e?.classList.add("grid-view"),e?.classList.remove("list-view"))}setupFilterPills(){const e=document.querySelectorAll('input[name="content-type"]');e?.forEach(e=>{e.addEventListener("change",()=>{this.updateContentTypeFilters(),this.updateLiveCounter()})});const t=document.querySelectorAll('input[name="period"]');t?.forEach(e=>{e.addEventListener("change",()=>{this.filterState.period=e.value,this.updateLiveCounter()})});const o=document.querySelectorAll('input[name="institute-type"]');o?.forEach(e=>{e.addEventListener("change",()=>{this.updateInstituteTypeFilters(),this.updateLiveCounter()})})}updateContentTypeFilters(){const e=document.querySelectorAll('input[name="content-type"]:checked');this.filterState.contentTypes=Array.from(e).map(e=>e.value)}updateInstituteTypeFilters(){const e=document.querySelectorAll('input[name="institute-type"]:checked');this.filterState.instituteTypes=Array.from(e).map(e=>e.value)}updateLiveCounter(){if(window.eduNetHomepage&&"function"==typeof window.eduNetHomepage.countMatchingPosts){const e=window.eduNetHomepage.countMatchingPosts(this.filterState),t=document.getElementById("applyFiltersBtn");if(t){const o=1===e?"Mostra 1 contenuto":`Mostra ${e} contenuti`;t.innerHTML=`\n          <i class="fas fa-check"></i>\n          <span>${o}</span>\n        `,0===e?(t.classList.add("disabled"),t.disabled=!0):(t.classList.remove("disabled"),t.disabled=!1)}}}setupActionButtons(){const e=document.getElementById("applyFiltersBtn"),t=document.getElementById("resetFiltersBtn"),o=document.getElementById("clearAllFilters"),n=document.getElementById("closeFiltersBtn");e?.addEventListener("click",()=>{this.applyFilters(),this.closeFilterDropdown()}),t?.addEventListener("click",()=>{this.resetFilters()}),o?.addEventListener("click",()=>{this.clearAllFilters()}),n?.addEventListener("click",()=>{this.closeFilterDropdown()})}async applyFilters(){console.log("üîç Applicazione filtri:",this.filterState),this.updateActiveFiltersDisplay(),this.updateFilterCount(),"discover"!==this.filterState.tab&&(window.eduNetHomepage&&"function"==typeof window.eduNetHomepage.applyFilters?window.eduNetHomepage.applyFilters(this.filterState):console.warn("Homepage not available, filters cannot be applied"))}resetFilters(){this.filterState={tab:this.filterState.tab,contentTypes:["post","news","project","methodology","event","educational_experience","collaboration"],period:"all",instituteTypes:[],sort:"recent",view:this.filterState.view},document.querySelectorAll('input[name="content-type"]').forEach(e=>{e.checked=!0});const e=document.querySelector('input[name="period"][value="all"]');e&&(e.checked=!0),document.querySelectorAll('input[name="institute-type"]').forEach(e=>{e.checked=!1}),this.updateLiveCounter(),this.applyFilters()}clearAllFilters(){this.filterState.contentTypes=[],this.filterState.instituteTypes=[],document.querySelectorAll('input[name="content-type"]').forEach(e=>{e.checked=!1}),document.querySelectorAll('input[name="institute-type"]').forEach(e=>{e.checked=!1}),this.updateLiveCounter(),this.updateActiveFiltersDisplay(),this.updateFilterCount()}updateActiveFiltersDisplay(){const e=document.getElementById("activeFiltersSummary"),t=document.getElementById("activeFilterTags");if(!e||!t)return;const o=[];this.filterState.contentTypes.length>0&&this.filterState.contentTypes.length<6&&this.filterState.contentTypes.forEach(e=>{o.push({label:this.getContentTypeLabel(e),value:e,category:"content"})}),"all"!==this.filterState.period&&o.push({label:this.getPeriodLabel(this.filterState.period),value:this.filterState.period,category:"period"}),this.filterState.instituteTypes.forEach(e=>{o.push({label:this.getInstituteTypeLabel(e),value:e,category:"institute"})}),o.length>0?(t.innerHTML=o.map(e=>`\n        <span class="filter-tag">\n          ${e.label}\n          <button class="filter-tag-remove" data-category="${e.category}" data-value="${e.value}">\n            <i class="fas fa-times"></i>\n          </button>\n        </span>\n      `).join(""),e.style.display="flex",t.querySelectorAll(".filter-tag-remove").forEach(e=>{e.addEventListener("click",()=>{this.removeFilter(e.dataset.category,e.dataset.value)})})):e.style.display="none"}removeFilter(e,t){"content"===e?(this.filterState.contentTypes=this.filterState.contentTypes.filter(e=>e!==t),document.querySelector(`input[name="content-type"][value="${t}"]`).checked=!1):"period"===e?(this.filterState.period="all",document.querySelector('input[name="period"][value="all"]').checked=!0):"institute"===e&&(this.filterState.instituteTypes=this.filterState.instituteTypes.filter(e=>e!==t),document.querySelector(`input[name="institute-type"][value="${t}"]`).checked=!1),this.applyFilters()}updateFilterCount(){const e=document.querySelector(".active-filters-count"),t=document.getElementById("quickFilterToggle");let o=0;this.filterState.contentTypes.length<6&&o++,"all"!==this.filterState.period&&o++,o+=this.filterState.instituteTypes.length,o>0?(e.textContent=o,e.classList.add("has-filters"),t.classList.add("active")):(e.classList.remove("has-filters"),t.classList.remove("active"))}createOverlay(){let e=document.querySelector(".filters-overlay");return e||(e=document.createElement("div"),e.className="filters-overlay",document.body.appendChild(e)),e}moveMenuToBody(){const e=document.getElementById("quickFilterMenu");console.log("üéõÔ∏è moveMenuToBody - Menu found:",!!e),e&&e.parentElement!==document.body?(this.originalMenuParent=e.parentElement,this.originalMenuNextSibling=e.nextSibling,document.body.appendChild(e),console.log("‚úÖ Filter menu moved to body for proper z-index"),console.log("üìã Menu now in body:",e.parentElement===document.body)):e?console.log("üìã Menu already in body"):console.warn("‚ö†Ô∏è Filter menu not found in DOM")}getContentTypeLabel(e){const t={post:"üìù Post",news:"üì∞ News",project:"üí° Progetti",methodology:"üìö Metodologie",event:"üñºÔ∏è Gallerie",educational_experience:"üéì Esperienze",collaboration:"ü§ù Collaborazioni"};return t[e]||e}getPeriodLabel(e){const t={today:"üìÖ Oggi",week:"üìÖ Settimana",month:"üìÖ Mese",year:"üìÖ Anno"};return t[e]||e}getInstituteTypeLabel(e){const t={primaria:"üéí Primaria",media:"üìñ Media",liceo:"üéì Liceo",tecnico:"‚öôÔ∏è Tecnico",professionale:"üîß Professionale",universita:"üèõÔ∏è Universit√†"};return t[e]||e}showNotification(e){console.log("‚úÖ",e)}}document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".modern-filters-container")&&(window.modernFilters=new ModernFilters)});