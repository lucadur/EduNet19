class EduNetErrorHandler{constructor(){this.errorMessages={"Invalid login credentials":"Email o password non corretti. Riprova.","Email not confirmed":"Devi confermare la tua email prima di accedere. Controlla la tua casella di posta.","User already registered":"Un utente con questa email Ã¨ giÃ  registrato. Prova ad accedere o usa un'altra email.","Signup not allowed for this instance":"La registrazione non Ã¨ attualmente consentita. Contatta l'amministratore.","Password should be at least 6 characters":"La password deve contenere almeno 6 caratteri.","Unable to validate email address":"Indirizzo email non valido. Controlla e riprova.","Email rate limit exceeded":"Troppe richieste. Attendi qualche minuto prima di riprovare.","duplicate key value violates unique constraint":"Questi dati sono giÃ  presenti nel sistema.","violates foreign key constraint":"Errore nei dati collegati. Riprova.","violates check constraint":"I dati inseriti non rispettano i requisiti del sistema.","permission denied":"Non hai i permessi necessari per questa operazione.","row level security":"Accesso negato. Verifica i tuoi permessi.",NetworkError:"Errore di connessione. Controlla la tua connessione internet.","Failed to fetch":"Impossibile connettersi al server. Riprova piÃ¹ tardi.",timeout:"La richiesta ha impiegato troppo tempo. Riprova.",validation_error:"I dati inseriti non sono validi. Controlla i campi evidenziati.",required_field:"Questo campo Ã¨ obbligatorio.",invalid_email:"Inserisci un indirizzo email valido.",password_mismatch:"Le password non coincidono.",weak_password:"La password deve contenere almeno 8 caratteri, una maiuscola, una minuscola, un numero e un carattere speciale.",unknown_error:"Si Ã¨ verificato un errore imprevisto. Riprova piÃ¹ tardi.",server_error:"Errore del server. Il nostro team Ã¨ stato notificato.",maintenance:"Il sistema Ã¨ temporaneamente in manutenzione. Riprova piÃ¹ tardi."},this.init()}init(){window.addEventListener("error",e=>{this.logError("JavaScript Error",e.error,{filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",e=>{this.logError("Unhandled Promise Rejection",e.reason),e.preventDefault()})}handleSupabaseError(e,r=""){console.error(`Supabase Error [${r}]:`,e);let o=this.getUserFriendlyMessage(e),t=this.getErrorCode(e);return this.logError("Supabase Error",e,{context:r,errorCode:t,userMessage:o}),{message:o,code:t,originalError:e}}handleValidationError(e,r,o){const t=this.getValidationMessage(o,e);return this.logError("Validation Error",new Error(t),{field:e,value:"string"==typeof r?r.substring(0,50):r,validationType:o}),{message:t,code:"validation_error",field:e}}handleNetworkError(e,r="",o=""){console.error("Network Error:",e);let t="Errore di connessione. Controlla la tua connessione internet.";return"AbortError"===e.name?t="Richiesta annullata.":e.message.includes("timeout")&&(t="La richiesta ha impiegato troppo tempo. Riprova."),this.logError("Network Error",e,{url:r,method:o,userMessage:t}),{message:t,code:"network_error",originalError:e}}getUserFriendlyMessage(e){if(!e)return this.errorMessages.unknown_error;const r=e.message||e.toString();for(const[e,o]of Object.entries(this.errorMessages))if(r.includes(e))return o;if(e.code)switch(e.code){case"PGRST116":return"Nessun dato trovato.";case"PGRST301":return"Troppi risultati trovati. Affina la ricerca.";case"23505":return"Questi dati sono giÃ  presenti nel sistema.";case"23503":return"Errore nei dati collegati.";case"42501":return"Non hai i permessi necessari per questa operazione.";default:return this.errorMessages.unknown_error}return this.errorMessages.unknown_error}getErrorCode(e){return e.code?e.code:e.status?e.status.toString():e.name?e.name:"unknown"}getValidationMessage(e,r){const o=this.getFieldDisplayName(r);switch(e){case"email":return`Inserisci un indirizzo email valido per ${o}.`;case"password":return"La password deve contenere almeno 8 caratteri, una maiuscola, una minuscola, un numero e un carattere speciale.";case"confirmPassword":return"Le password non coincidono.";case"instituteName":return"Il nome dell'istituto deve contenere almeno 2 caratteri.";case"firstName":return"Il nome deve contenere almeno 2 caratteri e solo lettere.";case"lastName":return"Il cognome deve contenere almeno 2 caratteri e solo lettere.";case"phone":return"Inserisci un numero di telefono valido.";case"website":return"Inserisci un URL valido (es. https://example.com).";case"required":return`${o} Ã¨ obbligatorio.`;default:return`${o} non Ã¨ valido.`}}getFieldDisplayName(e){const r={email:"Email",password:"Password",confirmPassword:"Conferma Password",instituteName:"Nome Istituto",instituteType:"Tipo Istituto",firstName:"Nome",lastName:"Cognome",phone:"Telefono",website:"Sito Web",pecEmail:"Email PEC"};return r[e]||e}logError(e,r,o={}){const t={timestamp:(new Date).toISOString(),type:e,message:r?.message||r,stack:r?.stack,context:o,userAgent:navigator.userAgent,url:window.location.href};console.group(`ðŸš¨ ${e}`),console.error("Error:",r),console.log("Context:",o),console.log("Full Log:",t),console.groupEnd(),this.isProduction()&&this.sendToLoggingService(t),this.saveErrorToLocalStorage(t)}isProduction(){return"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname}async sendToLoggingService(e){try{console.log("Sending error to logging service:",e)}catch(e){console.error("Failed to send error to logging service:",e)}}saveErrorToLocalStorage(e){try{const r=JSON.parse(localStorage.getItem("edunet_errors")||"[]");r.push(e),r.length>50&&r.splice(0,r.length-50),localStorage.setItem("edunet_errors",JSON.stringify(r))}catch(e){console.error("Failed to save error to localStorage:",e)}}getSavedErrors(){try{return JSON.parse(localStorage.getItem("edunet_errors")||"[]")}catch(e){return[]}}clearSavedErrors(){localStorage.removeItem("edunet_errors")}showErrorNotification(e,r=5e3){const o=this.handleSupabaseError(e);return window.eduNetAuth&&window.eduNetAuth.showNotification?window.eduNetAuth.showNotification(o.message,"error",r):alert(o.message),o}handle(e,r="",o=!0){let t;return t="ValidationError"===e.name?this.handleValidationError(e.field,e.value,e.type):"NetworkError"===e.name||e.message?.includes("fetch")?this.handleNetworkError(e):this.handleSupabaseError(e,r),o&&this.showErrorNotification(e),t}}window.eduNetErrorHandler=new EduNetErrorHandler,"undefined"!=typeof module&&module.exports&&(module.exports=EduNetErrorHandler);