"use strict";class EduNetSocialFeatures{constructor(){this.supabase=null,this.currentUser=null,this.isInitialized=!1,this.likesCache=new Map,this.commentsCache=new Map,this.init()}async init(){try{await this.waitForSupabase(),await this.waitForAuthSystem(),window.eduNetAuth&&(this.currentUser=window.eduNetAuth.getCurrentUser(),console.log("Social Features - Current user:",this.currentUser?.email||"Not logged in")),this.isInitialized=!0,console.log("âœ… EduNet Social Features - Initialized successfully")}catch(t){console.error("âŒ Failed to initialize social features:",t)}}async waitForAuthSystem(){const t=5e3,e=100;let o=0;return new Promise(s=>{const n=()=>{window.eduNetAuth&&window.eduNetAuth.isInitialized&&window.eduNetAuth.getCurrentUser()?(console.log("Social Features - Auth system ready"),s()):o>=t?(console.log("Social Features - Auth system timeout, continuing anyway"),s()):(o+=e,setTimeout(n,e))};n()})}async waitForSupabase(){const t=5e3,e=100;let o=0;return new Promise((s,n)=>{const i=()=>{window.supabaseClientManager?window.supabaseClientManager.getClient().then(t=>{this.supabase=t,s()}):o>=t?n(new Error("Supabase client not available")):(o+=e,setTimeout(i,e))};i()})}async toggleLike(t,e){if(!this.currentUser)return void this.showNotification("Devi essere loggato per mettere like","warning");if(!e)return void console.error("Like button element is undefined");if(e.disabled)return;let o=!1;try{this.setLikeButtonLoading(e,!0);const{data:s,error:n}=await this.supabase.from("post_likes").select("id").eq("post_id",t).eq("user_id",this.currentUser.id);if(n)throw console.error("Error checking existing like:",n),n;const i=s&&s.length>0?s[0]:null;i?(await this.removeLike(t,e,!1),o=!1):(await this.addLike(t,e,!1),o=!0),this.setLikeButtonLoading(e,!1),this.animateLikeButton(e,o)}catch(t){console.error("Error toggling like:",t),this.showNotification("Errore nell'aggiornamento del like","error"),this.setLikeButtonLoading(e,!1);const o=e.querySelector("i");o&&e.dataset.originalIcon&&(o.className=e.dataset.originalIcon,delete e.dataset.originalIcon)}}async addLike(t,e,o=!0){try{const{error:o}=await this.supabase.from("post_likes").insert([{post_id:t,user_id:this.currentUser.id}]);if(o)throw o;this.updateLikeCount(e,1),this.likesCache.set(`${t}_${this.currentUser.id}`,!0),await this.logPostActivity("like",t),console.log("Like added successfully")}catch(t){throw console.error("Error adding like:",t),t}}async removeLike(t,e,o=!0){try{const{error:o}=await this.supabase.from("post_likes").delete().eq("post_id",t).eq("user_id",this.currentUser.id);if(o)throw o;this.updateLikeCount(e,-1),this.likesCache.delete(`${t}_${this.currentUser.id}`),await this.logPostActivity("unlike",t),console.log("Like removed successfully")}catch(t){throw console.error("Error removing like:",t),t}}animateLikeButton(t,e){const o=t.querySelector("i");t.querySelector("span"),t.classList.remove("like-animating"),t.offsetWidth,t.classList.add("like-animating"),e?(o.classList.remove("far"),o.classList.add("fas"),t.classList.add("liked"),o.style.color="#e53e3e"):(o.classList.remove("fas"),o.classList.add("far"),t.classList.remove("liked"),o.style.color=""),setTimeout(()=>{t.classList.remove("like-animating")},600)}updateLikeCount(t,e){const o=t.querySelector("span");if(o){const t=parseInt(o.textContent)||0,s=Math.max(0,t+e);o.textContent=s,o.style.transform="scale(1.2)",setTimeout(()=>{o.style.transform="scale(1)"},150)}}setLikeButtonLoading(t,e){const o=t.querySelector("i");e?(t.disabled=!0,t.dataset.originalIcon=o.className,o.className="fas fa-spinner fa-spin"):(t.disabled=!1,t.dataset.originalIcon&&(o.className=t.dataset.originalIcon,delete t.dataset.originalIcon))}async showComments(t,e){try{e.innerHTML='<div class="comments-loading"><i class="fas fa-spinner fa-spin"></i> Caricamento commenti...</div>';const{data:o,error:s}=await this.supabase.from("post_comments").select("id, post_id, user_id, content, created_at, updated_at, is_edited, parent_comment_id").eq("post_id",t).is("parent_comment_id",null).order("created_at",{ascending:!0});if(s)throw s;console.log(`Loaded ${o?.length||0} comments for post ${t}`),o&&o.length>0&&await this.enrichCommentsWithUserData(o),this.renderComments(o,e,t),this.updateCommentCounter(t,o?.length||0)}catch(t){console.error("Error loading comments:",t),e.innerHTML='<div class="comments-error">Errore nel caricamento dei commenti</div>'}}updateCommentCounter(t,e){const o=document.querySelector(`[data-post-id="${t}"]`);if(!o)return;const s=o.querySelector(".comment-btn span");s&&(s.textContent=e,console.log(`Updated comment counter for post ${t}: ${e}`));const n=o.querySelector(".comments-toggle");if(n&&e>0){const t=n.childNodes[1];t&&t.nodeType===Node.TEXT_NODE&&(t.textContent=` Mostra commenti (${e})`)}}async enrichCommentsWithUserData(t){for(const e of t){e.user_profiles={};try{const{data:t}=await this.supabase.from("user_profiles").select("user_type").eq("id",e.user_id).maybeSingle();if(t)if(e.user_profiles.user_type=t.user_type,"istituto"===t.user_type){const{data:t}=await this.supabase.from("school_institutes").select("institute_name").eq("id",e.user_id).maybeSingle();t&&(e.user_profiles.school_institutes=t)}else if("privato"===t.user_type){const{data:t}=await this.supabase.from("private_users").select("first_name, last_name").eq("id",e.user_id).maybeSingle();t&&(e.user_profiles.private_users=t)}}catch(t){console.log("Could not load user details for comment:",e.id)}}}renderComments(t,e,o){if(!t||0===t.length)return void(e.innerHTML='\n        <div class="no-comments">\n          <i class="fas fa-comment-slash"></i>\n          <p>Nessun commento ancora. Sii il primo a commentare!</p>\n        </div>\n      ');const s=t.map(t=>this.createCommentHTML(t)).join("");e.innerHTML=`\n      <div class="comments-list">\n        ${s}\n      </div>\n    `}createCommentHTML(t){const e=this.getAuthorName(t.user_profiles),o=this.formatTimeAgo(new Date(t.created_at));return window.avatarManager&&t.user_id&&window.avatarManager.loadUserAvatar(t.user_id).then(e=>{if(e){const o=document.getElementById(`comment-avatar-${t.id}`);o&&window.avatarManager.setAvatarByUrl(o,e)}}).catch(e=>{console.warn(`Could not load avatar for comment ${t.id}:`,e)}),`\n      <div class="comment-item" data-comment-id="${t.id}" data-user-id="${t.user_id||""}">\n        <div class="comment-avatar" id="comment-avatar-${t.id}" data-user-id="${t.user_id||""}">\n          <i class="fas fa-user-circle"></i>\n        </div>\n        <div class="comment-content">\n          <div class="comment-header">\n            <span class="comment-author">${e}</span>\n            <span class="comment-time">${o}</span>\n            ${t.user_id===this.currentUser?.id?`\n              <div class="comment-actions">\n                <button class="comment-edit-btn" onclick="eduNetSocial.editComment('${t.id}')">\n                  <i class="fas fa-edit"></i>\n                </button>\n                <button class="comment-delete-btn" onclick="eduNetSocial.deleteComment('${t.id}')">\n                  <i class="fas fa-trash"></i>\n                </button>\n              </div>\n            `:""}\n          </div>\n          <div class="comment-text">${this.escapeHtml(t.content)}</div>\n          ${t.is_edited?'<span class="comment-edited">(modificato)</span>':""}\n        </div>\n      </div>\n    `}async addComment(t,e,o){if(!this.currentUser)return void this.showNotification("Devi essere loggato per commentare","warning");const s=this.currentUser.user_metadata?.user_type||"privato";if("privato"!==s)if(e.trim())try{const{data:s,error:n}=await this.supabase.from("post_comments").insert([{post_id:t,user_id:this.currentUser.id,content:e.trim()}]).select("*").single();if(n)throw n;s.user_profiles={user_type:this.currentUser.user_metadata?.user_type||"privato"},"istituto"===s.user_profiles.user_type?s.user_profiles.school_institutes={institute_name:this.currentUser.user_metadata?.institute_name||"Istituto"}:s.user_profiles.private_users={first_name:this.currentUser.user_metadata?.first_name||"",last_name:this.currentUser.user_metadata?.last_name||""},this.addCommentToUI(s,o),this.updateCommentsCount(t,1),await this.logPostActivity("comment",t),this.showNotification("Commento aggiunto con successo!","success")}catch(t){console.error("Error adding comment:",t),this.showNotification("Errore nell'aggiunta del commento","error")}else this.showNotification("Il commento non puÃ² essere vuoto","warning");else this.showNotification("Solo gli istituti possono commentare i post.","warning")}addCommentToUI(t,e){e.querySelector(".comments-list");const o=e.querySelector(".no-comments");o&&(e.innerHTML='<div class="comments-list"></div>');const s=this.createCommentHTML(t),n=e.querySelector(".comments-list");n.insertAdjacentHTML("beforeend",s);const i=n.lastElementChild;i.style.opacity="0",i.style.transform="translateY(20px)",setTimeout(()=>{i.style.transition="all 0.3s ease",i.style.opacity="1",i.style.transform="translateY(0)"},100)}updateCommentsCount(t,e){const o=document.querySelectorAll(`[data-post-id="${t}"] .comment-btn span`);o.forEach(t=>{const o=parseInt(t.textContent)||0,s=Math.max(0,o+e);t.textContent=s})}async createPost(t){if(window.eduNetAuth&&window.eduNetAuth.isAuthenticated()&&(this.currentUser=window.eduNetAuth.getCurrentUser()),!this.currentUser)return console.log("Social Features - No current user available"),this.showNotification("Devi essere loggato per creare un post","warning"),null;const e=this.currentUser.user_metadata?.user_type||"privato",o=window.eduNetAuth?.getUserProfile(),s=o?.is_collaborator&&("admin"===o?.collaborator_role||"editor"===o?.collaborator_role);if("privato"===e&&!s)return console.log("âŒ Utente privato non collaboratore, blocco creazione post"),this.showNotification("Solo gli istituti possono pubblicare post.","warning"),null;if("istituto"===e&&!s){const t=o?.verification_status,e="verified"===t||!0===o?.verified;e||console.log("âš ï¸ Istituto non verificato, avviso limitazioni")}s&&console.log("ðŸ‘¥ Collaboratore autorizzato a creare post");try{if(!t.title?.trim())return this.showNotification("Il titolo Ã¨ obbligatorio","warning"),null;if(!t.content?.trim())return this.showNotification("Il contenuto Ã¨ obbligatorio","warning"),null;if(console.log("Creating post for user:",this.currentUser.id),!this.supabase)return console.log("Supabase client not available"),this.showNotification("Servizio non disponibile al momento","warning"),null;try{let e=null;const o=window.eduNetAuth?.getUserProfile();if(o?.is_collaborator&&o?.collaborator_data)console.log("ðŸ‘¥ Utente Ã¨ un collaboratore, uso istituto associato"),e={id:o.collaborator_data.institute_id,institute_name:o.collaborator_data.institute_name};else if(o?.can_manage_institute&&o?.managed_institute_id)console.log("ðŸ‘¥ Utente puÃ² gestire istituto:",o.managed_institute_name),e={id:o.managed_institute_id,institute_name:o.managed_institute_name};else{const{data:t,error:o}=await this.supabase.from("school_institutes").select("id, institute_name").eq("id",this.currentUser.id).maybeSingle();console.log("ðŸ« Direct institute profile check:",{directProfile:t,profileError:o}),e=t}if(!e)return console.warn("âš ï¸ Utente non ha un profilo istituto completato"),this.showNotification("âš ï¸ Completa il tuo profilo istituto per pubblicare post","warning"),null;console.log("âœ… Creating post for institute:",e.institute_name);const s={post:"post",text:"post",project:"progetto_didattico",methodology:"metodologia",evento:"evento",notizia:"notizia"},n=s[t.type]||"post";console.log("ðŸ“¤ Creating post via RPC:",{institute_id:e.id,title:t.title.trim(),post_type:n});const{data:i,error:a}=await this.supabase.rpc("create_institute_post",{p_institute_id:e.id,p_title:t.title.trim(),p_content:t.content.trim(),p_post_type:n,p_published:!0});if(a)return console.error("âŒ RPC Error creating post:",a),this.showNotification("Errore nella pubblicazione del post","error"),null;if(!i.success)return console.error("âŒ Post creation failed:",i.error),this.showNotification(i.error||"Errore nella pubblicazione del post","error"),null;const r=i.post;return console.log("âœ… Post created successfully:",r.id),await this.logPostActivity("post_created",r.id),this.showNotification("Post pubblicato con successo!","success"),{...r,author_id:this.currentUser.id,user_profiles:{user_type:this.currentUser.user_metadata?.user_type||"istituto",school_institutes:{id:e.id,institute_name:e.institute_name},private_users:{first_name:this.currentUser.user_metadata?.first_name||"Utente",last_name:this.currentUser.user_metadata?.last_name||""}}}}catch(t){return"DATABASE_ERROR"===t.message?this.showNotification("Errore nella pubblicazione del post","error"):(console.log("Database connection issue"),this.showNotification("âš ï¸ Problema di connessione. Verifica la configurazione Supabase.","warning")),null}}catch(t){return this.showNotification("Errore nella pubblicazione del post","error"),null}}async logPostActivity(t,e,o={}){if(this.currentUser)try{await this.supabase.from("user_activities").insert([{user_id:this.currentUser.id,activity_type:t,target_type:"post",target_id:e,activity_data:o}])}catch(t){console.error("Error logging post activity:",t)}}showCreatePostModal(t="post"){console.log("ðŸŽ¨ showCreatePostModal called with type:",t);const e=document.querySelector(".create-post-modal");e&&(console.log("ðŸ—‘ï¸ Removing existing modal"),e.remove());const o=this.createPostModal(t);console.log("ðŸ“¦ Modal created:",o),o.style.cssText="\n      position: fixed !important;\n      top: 0 !important;\n      left: 0 !important;\n      right: 0 !important;\n      bottom: 0 !important;\n      z-index: 99999 !important;\n      display: flex !important;\n      align-items: center !important;\n      justify-content: center !important;\n      opacity: 0;\n      visibility: hidden;\n      transition: all 0.3s ease;\n    ",document.body.appendChild(o),console.log("âœ… Modal appended to body"),setTimeout(()=>{o.style.opacity="1",o.style.visibility="visible",o.classList.add("show"),console.log("âœ… Modal now visible");const t=o.querySelector("#post-title");t&&t.focus()},10)}createPostModal(t){const e=document.createElement("div");return e.className="create-post-modal",e.innerHTML=`\n      <div class="create-post-modal-backdrop"></div>\n      <div class="create-post-modal-content">\n        <div class="create-post-modal-header">\n          <h3>\n            <i class="fas fa-${this.getPostTypeIcon(t)}" aria-hidden="true"></i>\n            ${this.getPostTypeTitle(t)}\n          </h3>\n          <button class="create-post-modal-close">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        <div class="create-post-modal-body">\n          <form class="create-post-form" id="create-post-form">\n            <div class="form-group">\n              <label for="post-title">Titolo *</label>\n              <input \n                type="text" \n                id="post-title" \n                name="title" \n                placeholder="Inserisci il titolo del ${t}..."\n                required\n                maxlength="200"\n              >\n              <div class="char-counter">\n                <span class="current">0</span>/<span class="max">200</span>\n              </div>\n            </div>\n            \n            <div class="form-group">\n              <label for="post-content">Contenuto *</label>\n              <textarea \n                id="post-content" \n                name="content" \n                placeholder="Descrivi il tuo ${t}..."\n                required\n                rows="8"\n                maxlength="5000"\n              ></textarea>\n              <div class="char-counter">\n                <span class="current">0</span>/<span class="max">5000</span>\n              </div>\n            </div>\n            \n            <div class="form-group">\n              <label for="post-type">Tipo di contenuto</label>\n              <select id="post-type" name="type">\n                <option value="post" ${"post"===t?"selected":""}>Post generale</option>\n                <option value="project" ${"project"===t?"selected":""}>Progetto didattico</option>\n                <option value="methodology" ${"methodology"===t?"selected":""}>Metodologia educativa</option>\n                <option value="evento" ${"evento"===t?"selected":""}>Evento</option>\n                <option value="notizia" ${"notizia"===t?"selected":""}>Notizia</option>\n              </select>\n            </div>\n            \n            <div class="form-actions">\n              <button type="button" class="btn btn-outline cancel-btn">\n                <i class="fas fa-times" aria-hidden="true"></i>\n                Annulla\n              </button>\n              <button type="submit" class="btn btn-primary submit-btn">\n                <i class="fas fa-paper-plane" aria-hidden="true"></i>\n                Pubblica ${t}\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    `,this.attachCreatePostModalListeners(e,t),e}getPostTypeIcon(t){const e={post:"plus",project:"lightbulb",methodology:"book-open"};return e[t]||"plus"}getPostTypeTitle(t){const e={post:"Crea Nuovo Post",project:"Crea Nuovo Progetto",methodology:"Crea Nuova Metodologia"};return e[t]||"Crea Nuovo Post"}attachCreatePostModalListeners(t,e){console.log("ðŸ”— Attaching modal listeners...");const o=t.querySelector(".create-post-modal-close"),s=t.querySelector(".create-post-modal-backdrop"),n=t.querySelector(".cancel-btn");[o,s,n].forEach(e=>{e&&e.addEventListener("click",()=>{this.closeCreatePostModal(t)})}),console.log("âœ… Close listeners attached");const i=t.querySelector("#post-title"),a=t.querySelector("#post-content");i&&this.setupCharacterCounter(i,t.querySelector(".form-group:nth-child(1) .char-counter")),a&&this.setupCharacterCounter(a,t.querySelector(".form-group:nth-child(2) .char-counter"));const r=t.querySelector("#create-post-form");r.addEventListener("submit",async e=>{e.preventDefault(),await this.handleCreatePostSubmit(r,t)}),a&&a.addEventListener("input",()=>{this.autoResizeTextarea(a)}),t.addEventListener("keydown",e=>{"Escape"===e.key?this.closeCreatePostModal(t):(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&r.dispatchEvent(new Event("submit"))})}setupCharacterCounter(t,e){const o=()=>{const o=t.value.length,s=parseInt(t.getAttribute("maxlength")),n=e.querySelector(".current");n.textContent=o,o>.9*s?e.classList.add("warning"):e.classList.remove("warning"),o>=s?e.classList.add("error"):e.classList.remove("error")};t.addEventListener("input",o),o()}autoResizeTextarea(t){t.style.height="auto",t.style.height=Math.min(t.scrollHeight,300)+"px"}async handleCreatePostSubmit(t,e){const o=e.querySelector(".submit-btn"),s=o.innerHTML;try{o.disabled=!0,o.innerHTML='<i class="fas fa-spinner fa-spin"></i> Pubblicando...';const s=new FormData(t),n={title:s.get("title"),content:s.get("content"),type:s.get("type")},i=await this.createPost(n);i&&(window.eduNetHomepage&&this.addPostToFeed(i),this.closeCreatePostModal(e))}catch(t){console.error("Error submitting post:",t),this.showNotification("Errore nella pubblicazione del post","error")}finally{o.disabled=!1,o.innerHTML=s}}addPostToFeed(t){if(!window.eduNetHomepage)return;const e={id:t.id,title:t.title,content:t.content,author:this.getAuthorName(t.user_profiles),created_at:new Date(t.created_at),likes:t.likes_count||0,comments:t.comments_count||0,type:t.post_type},o=window.eduNetHomepage.createPostElement(e,!1),s=document.getElementById("feed-content");if(s){const t=document.getElementById("mock-data-banner");t&&t.remove();const n=s.firstElementChild;n?s.insertBefore(o,n):s.appendChild(o);const i=s.querySelector(".feed-empty");i&&(i.style.display="none"),o.style.opacity="0",o.style.transform="translateY(-20px)",setTimeout(()=>{o.style.transition="all 0.5s ease",o.style.opacity="1",o.style.transform="translateY(0)"},100),window.eduNetHomepage.feedData&&window.eduNetHomepage.feedData.unshift(e)}}closeCreatePostModal(t){t.classList.remove("show"),setTimeout(()=>{t.remove()},300)}showShareModal(t,e,o){const s=this.createShareModal(t,e,o);document.body.appendChild(s),setTimeout(()=>{s.classList.add("show")},10)}createShareModal(t,e,o){const s=document.createElement("div");return s.className="share-modal",s.innerHTML=`\n      <div class="share-modal-backdrop"></div>\n      <div class="share-modal-content">\n        <div class="share-modal-header">\n          <h3>Condividi questo post</h3>\n          <button class="share-modal-close">\n            <i class="fas fa-times"></i>\n          </button>\n        </div>\n        <div class="share-modal-body">\n          <div class="share-options">\n            <button class="share-option" data-platform="facebook">\n              <i class="fab fa-facebook-f"></i>\n              <span>Facebook</span>\n            </button>\n            <button class="share-option" data-platform="twitter">\n              <i class="fab fa-twitter"></i>\n              <span>Twitter</span>\n            </button>\n            <button class="share-option" data-platform="linkedin">\n              <i class="fab fa-linkedin-in"></i>\n              <span>LinkedIn</span>\n            </button>\n            <button class="share-option" data-platform="whatsapp">\n              <i class="fab fa-whatsapp"></i>\n              <span>WhatsApp</span>\n            </button>\n            <button class="share-option" data-platform="telegram">\n              <i class="fab fa-telegram-plane"></i>\n              <span>Telegram</span>\n            </button>\n            <button class="share-option" data-platform="email">\n              <i class="fas fa-envelope"></i>\n              <span>Email</span>\n            </button>\n          </div>\n          <div class="share-link">\n            <label>Link diretto:</label>\n            <div class="share-link-input">\n              <input type="text" value="${o}" readonly id="share-url-${t}" name="shareUrl">\n              <button class="copy-link-btn" data-url="${o}">\n                <i class="fas fa-copy"></i>\n                Copia\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `,this.attachShareModalListeners(s,t,e,o),s}attachShareModalListeners(t,e,o,s){const n=t.querySelector(".share-modal-close"),i=t.querySelector(".share-modal-backdrop");[n,i].forEach(e=>{e.addEventListener("click",()=>{this.closeShareModal(t)})});const a=t.querySelectorAll(".share-option");a.forEach(n=>{n.addEventListener("click",()=>{const i=n.dataset.platform;this.shareToPlatform(i,e,o,s),this.closeShareModal(t)})});const r=t.querySelector(".copy-link-btn");r.addEventListener("click",()=>{this.copyToClipboard(s),this.recordShare(e,"copy_link")})}async shareToPlatform(t,e,o,s){const n={facebook:`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(s)}`,twitter:`https://twitter.com/intent/tweet?text=${encodeURIComponent(o)}&url=${encodeURIComponent(s)}`,linkedin:`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(s)}`,whatsapp:`https://wa.me/?text=${encodeURIComponent(o+" "+s)}`,telegram:`https://t.me/share/url?url=${encodeURIComponent(s)}&text=${encodeURIComponent(o)}`,email:`mailto:?subject=${encodeURIComponent(o)}&body=${encodeURIComponent(o+"\n\n"+s)}`};n[t]&&(window.open(n[t],"_blank","width=600,height=400"),await this.recordShare(e,t))}async recordShare(t,e){if(this.currentUser)try{const{error:o}=await this.supabase.from("post_shares").insert([{post_id:t,user_id:this.currentUser.id,platform:e}]);if(o)throw o;this.updateSharesCount(t,1)}catch(t){console.error("Error recording share:",t)}}updateSharesCount(t,e){const o=document.querySelectorAll(`[data-post-id="${t}"] .share-btn span`);o.forEach(t=>{if("Condividi"!==t.textContent){const o=parseInt(t.textContent)||0,s=Math.max(0,o+e);t.textContent=s}})}closeShareModal(t){t.classList.remove("show"),setTimeout(()=>{t.remove()},300)}async copyToClipboard(t){try{await navigator.clipboard.writeText(t),this.showNotification("Link copiato negli appunti!","success")}catch(t){console.error("Error copying to clipboard:",t),this.showNotification("Errore nella copia del link","error")}}getAuthorName(t){if(!t)return"Utente";if("istituto"===t.user_type)return t.school_institutes?.institute_name||"Istituto";if("privato"===t.user_type){const e=t.private_users?.first_name||"",o=t.private_users?.last_name||"";return`${e} ${o}`.trim()||"Utente"}return"Utente"}formatTimeAgo(t){const e=new Date,o=e-t,s=Math.floor(o/6e4),n=Math.floor(o/36e5),i=Math.floor(o/864e5);return s<1?"Ora":s<60?`${s}m fa`:n<24?`${n}h fa`:i<7?`${i}g fa`:t.toLocaleDateString("it-IT")}escapeHtml(t){if(window.sanitizer&&window.sanitizer.escapeHtml)return window.sanitizer.escapeHtml(t);const e=document.createElement("div");return e.textContent=t,e.innerHTML}showNotification(t,e="info"){window.eduNetApp&&window.eduNetApp.showNotification?window.eduNetApp.showNotification(t,e):window.eduNetAuth&&window.eduNetAuth.showNotification?window.eduNetAuth.showNotification(t,e):"error"===e&&console.log(`âš ï¸ ${t}`)}}window.eduNetSocial=new EduNetSocialFeatures,console.log("ðŸŽ¯ EduNet Social Features - Script loaded successfully");