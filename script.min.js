"use strict";class EduNetApp{constructor(){this.isInitialized=!1,this.loadingScreen=null,this.modals=new Map,this.forms=new Map,this.currentUserType=null,this.observers=new Map,this.handleDOMContentLoaded=this.handleDOMContentLoaded.bind(this),this.handleWindowLoad=this.handleWindowLoad.bind(this),this.handleResize=this.handleResize.bind(this),this.handleScroll=this.handleScroll.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.handleClick=this.handleClick.bind(this),this.init()}async init(){try{"loading"===document.readyState?document.addEventListener("DOMContentLoaded",this.handleDOMContentLoaded):await this.handleDOMContentLoaded(),"complete"!==document.readyState?window.addEventListener("load",this.handleWindowLoad):this.handleWindowLoad()}catch(e){console.error("Failed to initialize EduNet application:",e),this.handleInitializationError(e)}}async handleDOMContentLoaded(){console.log("ðŸš€ EduNet19 - Initializing application...");try{await this.initializeCore(),this.setupUI(),this.setupEventListeners(),await this.initializeServices(),this.setupAnimations(),this.isInitialized=!0,console.log("âœ… EduNet19 - Application initialized successfully")}catch(e){console.error("âŒ Failed to initialize application:",e),this.handleInitializationError(e)}}handleWindowLoad(){this.hideLoadingScreen(),this.initializePerformanceOptimizations(),this.setupLazyLoading(),console.log("ðŸŽ‰ EduNet19 - Application fully loaded")}async initializeCore(){this.loadingScreen=document.getElementById("loading-screen"),this.initializeModals(),this.initializeForms(),this.initializeNotifications()}initializeModals(){const e=document.querySelectorAll(".modal");e.forEach(e=>{const t=e.id;this.modals.set(t,{element:e,isOpen:!1,backdrop:e.querySelector(".modal-backdrop"),container:e.querySelector(".modal-container"),closeButton:e.querySelector(".modal-close")})})}initializeForms(){const e=document.querySelectorAll(".auth-form");e.forEach(e=>{const t=e.id;this.forms.set(t,{element:e,validator:null,isSubmitting:!1}),this.setupFormValidation(e),this.setupFormSubmission(e)})}setupFormValidation(e){const t=e.querySelectorAll("input[data-validate]");t.forEach(e=>{e.addEventListener("input",e=>{this.debounce(()=>this.validateField(e.target),300)()}),e.addEventListener("blur",e=>{this.validateField(e.target)})})}setupFormSubmission(e){e.addEventListener("submit",async t=>{t.preventDefault();const n=e.id,o=this.forms.get(n);if(!o.isSubmitting)try{o.isSubmitting=!0,this.setFormLoading(e,!0);const t=this.validateForm(e);if(!t)throw new Error("Form validation failed");await this.submitForm(e)}catch(e){console.error("Form submission error:",e),this.showNotification(e.message||"Errore durante l'invio del form","error")}finally{o.isSubmitting=!1,this.setFormLoading(e,!1)}})}validateField(e){const t=e.getAttribute("data-validate"),n=e.value.trim();if(!window.eduNetValidation||!window.eduNetValidation.validators[t])return!0;let o;if("confirmPassword"===t){const t=e.form.querySelector('input[data-validate="password"]');o=window.eduNetValidation.validators.confirmPassword(t?.value,n)}else o=window.eduNetValidation.validators[t](n);return this.displayFieldValidation(e,o),o.isValid||!0===o}validateForm(e){const t=e.querySelectorAll("input[data-validate]");let n=!0;return t.forEach(e=>{const t=this.validateField(e);t||(n=!1)}),n}displayFieldValidation(e,t){const n=document.getElementById(`${e.id}-error`);e.classList.remove("is-valid","is-invalid"),n&&(n.textContent=""),!0===t||t.isValid&&e.value.trim()?e.classList.add("is-valid"):(!1===t||!t.isValid&&t.errors)&&(e.classList.add("is-invalid"),n&&t.errors&&(n.textContent=t.errors[0]))}async submitForm(e){const t=e.id,n=new FormData(e),o=Object.fromEntries(n.entries());switch(t){case"loginForm":await this.handleLogin(o);break;case"instituteForm":await this.handleInstituteRegistration(o);break;case"privateForm":await this.handlePrivateRegistration(o);break;case"forgotPasswordForm":await this.handleForgotPassword(o);break;default:throw new Error("Unknown form type")}}async handleLogin(e){if(!window.eduNetAuth)throw new Error("Authentication service not available");const t=await window.eduNetAuth.login(e.email,e.password);t.success&&(this.closeModal("loginModal"),this.resetForm("loginForm"))}async handleInstituteRegistration(e){if(!window.eduNetAuth)throw new Error("Authentication service not available");const t=await window.eduNetAuth.registerInstitute(e);t.success&&(this.closeModal("registerModal"),this.resetForm("instituteForm"),this.resetUserTypeSelection())}async handlePrivateRegistration(e){if(!window.eduNetAuth)throw new Error("Authentication service not available");const t=await window.eduNetAuth.registerPrivateUser(e);t.success&&(this.closeModal("registerModal"),this.resetForm("privateForm"),this.resetUserTypeSelection())}async handleForgotPassword(e){if(!window.eduNetPasswordReset)throw new Error("Password reset service not available");const t=await window.eduNetPasswordReset.sendPasswordResetEmail(e.email);t.success&&(this.closeForgotPasswordModal(),this.resetForm("forgotPasswordForm"))}setupUI(){this.setupUserTypeSelection(),this.setupPasswordToggles(),this.setupModalInteractions(),this.setupNavigation()}setupUserTypeSelection(){const e=document.querySelectorAll(".user-type-card");e.forEach(e=>{e.addEventListener("click",t=>{const n=e.onclick.toString().includes("institute")?"institute":"private";this.selectUserType(n)})})}selectUserType(e){this.currentUserType=e;const t=document.querySelectorAll(".user-type-card"),n=document.getElementById("instituteForm"),o=document.getElementById("privateForm"),i=document.querySelector(".user-type-selection");t.forEach(e=>e.classList.remove("active")),n.style.display="none",o.style.display="none",n.classList.remove("active"),o.classList.remove("active"),"institute"===e?(t[0].classList.add("active"),n.style.display="grid",n.classList.add("active")):"private"===e&&(t[1].classList.add("active"),o.style.display="grid",o.classList.add("active")),i.style.display="none",setTimeout(()=>{const t=("institute"===e?n:o).querySelector("input");t&&t.focus()},100)}resetUserTypeSelection(){this.currentUserType=null;const e=document.querySelectorAll(".user-type-card"),t=document.getElementById("instituteForm"),n=document.getElementById("privateForm"),o=document.querySelector(".user-type-selection");e.forEach(e=>e.classList.remove("active")),t.style.display="none",n.style.display="none",t.classList.remove("active"),n.classList.remove("active"),o.style.display="block"}setupPasswordToggles(){const e=document.querySelectorAll(".password-toggle");e.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=e.parentElement.querySelector("input"),o=e.querySelector("i");"password"===n.type?(n.type="text",o.classList.remove("fa-eye"),o.classList.add("fa-eye-slash"),e.setAttribute("aria-label","Nascondi password")):(n.type="password",o.classList.remove("fa-eye-slash"),o.classList.add("fa-eye"),e.setAttribute("aria-label","Mostra password"))})})}setupModalInteractions(){const e=document.getElementById("forgotPasswordLink");e&&e.addEventListener("click",e=>{e.preventDefault(),this.openForgotPasswordModal()})}setupNavigation(){let e=window.scrollY;window.addEventListener("scroll",()=>{const t=document.querySelector(".header"),n=window.scrollY;n>100?t.classList.add("scrolled"):t.classList.remove("scrolled"),e=n})}setupEventListeners(){window.addEventListener("resize",this.debounce(this.handleResize,250)),window.addEventListener("scroll",this.throttle(this.handleScroll,16)),document.addEventListener("keydown",this.handleKeydown),document.addEventListener("click",this.handleClick),this.modals.forEach((e,t)=>{e.backdrop&&e.backdrop.addEventListener("click",()=>{this.closeModal(t)}),e.closeButton&&e.closeButton.addEventListener("click",()=>{this.closeModal(t)})})}handleClick(e){if(e.target.matches('[onclick*="openModal"]')){e.preventDefault();const t=e.target.onclick.toString().match(/'([^']+)'/)?.[1];t&&this.openModal("login"===t?"loginModal":"registerModal")}if(e.target.matches('[onclick*="switchModal"]')){e.preventDefault();const t=e.target.onclick.toString().match(/'([^']+)'.*'([^']+)'/);t&&this.switchModal(t[1]+"Modal",t[2]+"Modal")}}handleKeydown(e){if("Escape"===e.key){this.modals.forEach((e,t)=>{e.isOpen&&this.closeModal(t)});const e=document.getElementById("forgotPasswordModal");e&&"block"===e.style.display&&this.closeForgotPasswordModal()}}handleResize(){this.modals.forEach(e=>{e.isOpen&&this.updateModalPosition(e)})}handleScroll(){this.updateScrollAnimations()}async initializeServices(){await this.waitForServices(),window.eduNetValidation&&window.eduNetValidation.initializeValidation(),window.eduNetAuth&&(await window.eduNetAuth.initialize(),window.eduNetAuth.isAuthenticated()&&(console.log("Utente giÃ  autenticato, mostra opzione per andare alla homepage"),this.showAuthenticatedUserOptions())),window.eduNetErrorHandler}showAuthenticatedUserOptions(){const e=document.getElementById("authenticated-user-banner");if(e)return;const t=document.createElement("div");t.id="authenticated-user-banner",t.className="authenticated-banner",t.innerHTML='\n      <div class="banner-content">\n        <div class="banner-message">\n          <i class="fas fa-user-check" aria-hidden="true"></i>\n          <span>Sei giÃ  connesso! Vuoi andare alla homepage?</span>\n        </div>\n        <div class="banner-actions">\n          <button class="btn btn-primary" onclick="window.location.href=\'homepage.html\'">\n            <i class="fas fa-home" aria-hidden="true"></i>\n            Vai alla Homepage\n          </button>\n          <button class="btn btn-outline" onclick="this.parentElement.parentElement.parentElement.remove()">\n            <i class="fas fa-times" aria-hidden="true"></i>\n            Rimani qui\n          </button>\n        </div>\n      </div>\n    ';const n=document.createElement("style");n.textContent="\n      .authenticated-banner {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));\n        color: white;\n        padding: var(--space-4);\n        z-index: var(--z-toast);\n        box-shadow: var(--shadow-lg);\n        animation: slideDown 0.5s ease-out;\n      }\n      \n      .banner-content {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        max-width: 1200px;\n        margin: 0 auto;\n        gap: var(--space-4);\n      }\n      \n      .banner-message {\n        display: flex;\n        align-items: center;\n        gap: var(--space-3);\n        font-weight: var(--font-weight-medium);\n      }\n      \n      .banner-message i {\n        font-size: var(--font-size-lg);\n        color: var(--color-secondary);\n      }\n      \n      .banner-actions {\n        display: flex;\n        gap: var(--space-3);\n      }\n      \n      .banner-actions .btn {\n        padding: var(--space-2) var(--space-4);\n        font-size: var(--font-size-sm);\n        min-height: auto;\n      }\n      \n      @keyframes slideDown {\n        from {\n          transform: translateY(-100%);\n          opacity: 0;\n        }\n        to {\n          transform: translateY(0);\n          opacity: 1;\n        }\n      }\n      \n      @media (max-width: 768px) {\n        .banner-content {\n          flex-direction: column;\n          text-align: center;\n          gap: var(--space-3);\n        }\n        \n        .banner-actions {\n          justify-content: center;\n        }\n      }\n    ",document.head.appendChild(n),document.body.appendChild(t),setTimeout(()=>{t.parentElement&&(t.style.animation="slideUp 0.5s ease-out forwards",setTimeout(()=>{t.parentElement&&t.remove()},500))},1e4)}async waitForServices(){const e=1e4,t=100;let n=0;return new Promise(o=>{const i=()=>{window.eduNetAuth&&window.eduNetValidation&&window.eduNetErrorHandler&&window.eduNetPasswordReset?o():n>=e?(console.warn("Some services may not be available"),o()):(n+=t,setTimeout(i,t))};i()})}setupAnimations(){this.setupScrollAnimations(),this.setupHoverEffects(),this.setupLoadingAnimations()}setupScrollAnimations(){const e={threshold:.1,rootMargin:"0px 0px -50px 0px"},t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("animate-in")})},e),n=document.querySelectorAll(".feature-card, .benefit-item, .stat-item");n.forEach(e=>{e.classList.add("animate-on-scroll"),t.observe(e)}),this.observers.set("scroll",t)}setupHoverEffects(){const e=document.querySelectorAll(".btn, .feature-card, .user-type-card");e.forEach(e=>{e.addEventListener("mouseenter",()=>{e.style.transform="translateY(-2px)"}),e.addEventListener("mouseleave",()=>{e.style.transform=""})})}setupLoadingAnimations(){const e=document.createElement("style");e.textContent="\n      .animate-on-scroll {\n        opacity: 0;\n        transform: translateY(30px);\n        transition: opacity 0.6s ease, transform 0.6s ease;\n      }\n      \n      .animate-on-scroll.animate-in {\n        opacity: 1;\n        transform: translateY(0);\n      }\n      \n      .form-loading {\n        pointer-events: none;\n        opacity: 0.7;\n      }\n      \n      .form-loading .btn {\n        position: relative;\n        color: transparent;\n      }\n      \n      .form-loading .btn::after {\n        content: '';\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        width: 20px;\n        height: 20px;\n        margin: -10px 0 0 -10px;\n        border: 2px solid transparent;\n        border-top: 2px solid currentColor;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n      }\n      \n      @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n    ",document.head.appendChild(e)}initializePerformanceOptimizations(){this.optimizeImages(),this.preloadCriticalResources()}setupLazyLoading(){if("IntersectionObserver"in window){const e=document.querySelectorAll("img[data-src]"),t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,n.removeAttribute("data-src"),t.unobserve(n)}})});e.forEach(e=>t.observe(e)),this.observers.set("images",t)}}initializeNotifications(){let e=document.getElementById("notification-container");e||(e=document.createElement("div"),e.id="notification-container",e.className="notification-container",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),document.body.appendChild(e))}showNotification(e,t="info",n=5e3){const o=document.getElementById("notification-container");if(!o)return;const i=document.createElement("div");i.className=`notification ${t}`,i.innerHTML=`\n      <div class="notification-icon">\n        <i class="fas ${this.getNotificationIcon(t)}"></i>\n      </div>\n      <div class="notification-content">\n        <div class="notification-message">${e}</div>\n      </div>\n      <button class="notification-close" aria-label="Chiudi notifica">\n        <i class="fas fa-times"></i>\n      </button>\n    `;const s=i.querySelector(".notification-close");return s.addEventListener("click",()=>{this.removeNotification(i)}),o.appendChild(i),n>0&&setTimeout(()=>{this.removeNotification(i)},n),i}removeNotification(e){e&&e.parentElement&&(e.style.animation="slideOutRight 0.3s ease-out forwards",setTimeout(()=>{e.parentElement&&e.parentElement.removeChild(e)},300))}getNotificationIcon(e){const t={success:"fa-check-circle",error:"fa-exclamation-circle",warning:"fa-exclamation-triangle",info:"fa-info-circle"};return t[e]||t.info}openModal(e){const t=this.modals.get(e);t&&(t.element.style.display="flex",t.element.setAttribute("aria-hidden","false"),t.isOpen=!0,document.body.style.overflow="hidden",setTimeout(()=>{const e=t.element.querySelector("input");e&&e.focus()},100),t.container.style.animation="slideUp 0.4s ease-out")}closeModal(e){const t=this.modals.get(e);if(!t)return;t.element.style.display="none",t.element.setAttribute("aria-hidden","true"),t.isOpen=!1,document.body.style.overflow="";const n=t.element.querySelector("form");n&&this.resetForm(n.id),"registerModal"===e&&this.resetUserTypeSelection()}switchModal(e,t){this.closeModal(e),setTimeout(()=>{this.openModal(t)},100)}openForgotPasswordModal(){const e=document.getElementById("forgotPasswordModal");e&&(e.style.display="flex",e.setAttribute("aria-hidden","false"),setTimeout(()=>{const t=e.querySelector("input");t&&t.focus()},100))}closeForgotPasswordModal(){const e=document.getElementById("forgotPasswordModal");e&&(e.style.display="none",e.setAttribute("aria-hidden","true"),this.resetForm("forgotPasswordForm"))}resetForm(e){const t=document.getElementById(e);if(!t)return;t.reset();const n=t.querySelectorAll("input");n.forEach(e=>{e.classList.remove("is-valid","is-invalid")});const o=t.querySelectorAll(".form-error");o.forEach(e=>{e.textContent=""});const i=t.querySelectorAll('input[type="text"][data-validate="password"], input[type="text"][data-validate="confirmPassword"]');i.forEach(e=>{e.type="password";const t=e.parentElement.querySelector(".password-toggle i");t&&(t.classList.remove("fa-eye-slash"),t.classList.add("fa-eye"))})}setFormLoading(e,t){t?e.classList.add("form-loading"):e.classList.remove("form-loading")}debounce(e,t){let n;return function(...o){const i=()=>{clearTimeout(n),e(...o)};clearTimeout(n),n=setTimeout(i,t)}}throttle(e,t){let n;return function(...o){n||(e.apply(this,o),n=!0,setTimeout(()=>n=!1,t))}}hideLoadingScreen(){this.loadingScreen&&(this.loadingScreen.classList.add("hidden"),setTimeout(()=>{this.loadingScreen.style.display="none"},350))}handleInitializationError(e){console.error("Initialization error:",e),this.hideLoadingScreen(),this.showNotification("Si Ã¨ verificato un errore durante il caricamento. Ricarica la pagina.","error",0)}updateScrollAnimations(){const e=window.scrollY,t=(window.innerHeight,document.querySelector(".hero-background"));t&&(t.style.transform=`translateY(${.5*e}px)`)}updateModalPosition(e){}optimizeImages(){const e=document.querySelectorAll("img");e.forEach(e=>{e.loading||(e.loading="lazy")})}preloadCriticalResources(){const e=[];e.forEach(e=>{const t=document.createElement("link");t.rel="preload",t.href=e.href,t.as=e.as,document.head.appendChild(t)})}destroy(){document.removeEventListener("DOMContentLoaded",this.handleDOMContentLoaded),window.removeEventListener("load",this.handleWindowLoad),window.removeEventListener("resize",this.handleResize),window.removeEventListener("scroll",this.handleScroll),document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("click",this.handleClick),this.observers.forEach(e=>{e.disconnect()}),this.modals.clear(),this.forms.clear(),this.observers.clear(),console.log("EduNet19 application destroyed")}}window.openModal=function(e){if(window.eduNetApp){const t="login"===e?"loginModal":"registerModal";window.eduNetApp.openModal(t)}},window.closeModal=function(e){if(window.eduNetApp){const t="login"===e?"loginModal":"registerModal";window.eduNetApp.closeModal(t)}},window.switchModal=function(e,t){if(window.eduNetApp){const n="login"===e?"loginModal":"registerModal",o="login"===t?"loginModal":"registerModal";window.eduNetApp.switchModal(n,o)}},window.selectUserType=function(e){window.eduNetApp&&window.eduNetApp.selectUserType(e)},window.togglePassword=function(e){console.log("ðŸ‘ï¸ togglePassword chiamato per:",e);const t=document.getElementById(e);if(!t)return void console.error("âŒ Input non trovato:",e);const n=t.parentElement;if(!n)return void console.error("âŒ Input group non trovato");const o=n.querySelector(".password-toggle");if(!o)return void console.error("âŒ Button toggle non trovato");const i=o.querySelector("i");if(!i)return void console.error("âŒ Icona non trovata");const s=t.getAttribute("type"),a="password"===s?"text":"password";if(t.dataset.passwordToggled=a,t.setAttribute("type",a),t.type=a,"text"===a?(i.classList.remove("fa-eye"),i.classList.add("fa-eye-slash"),o.setAttribute("aria-label","Nascondi password"),console.log("âœ… Password mostrata")):(i.classList.remove("fa-eye-slash"),i.classList.add("fa-eye"),o.setAttribute("aria-label","Mostra password"),console.log("âœ… Password nascosta")),!t.dataset.observerAttached){const n=new MutationObserver(e=>{e.forEach(e=>{if("attributes"===e.type&&"type"===e.attributeName){const e=t.dataset.passwordToggled;e&&t.type!==e&&(console.log("ðŸ›¡ï¸ Prevenuto reset del type da",t.type,"a",e),t.type=e,t.setAttribute("type",e))}})});n.observe(t,{attributes:!0,attributeFilter:["type"]}),t.dataset.observerAttached="true",console.log("ðŸ›¡ï¸ MutationObserver attivato per",e)}},window.closeForgotPasswordModal=function(){window.eduNetApp&&window.eduNetApp.closeForgotPasswordModal()},window.scrollToSection=function(e){const t=document.getElementById(e);if(!t)return void console.warn("âš ï¸ Section not found:",e);const n=document.querySelector(".header"),o=n?n.offsetHeight:0,i=t.getBoundingClientRect().top+window.pageYOffset-o-20;window.scrollTo({top:i,behavior:"smooth"}),console.log("ðŸ“œ Scrolling to section:",e)},window.eduNetApp=new EduNetApp,window.addEventListener("error",e=>{console.error("Global error:",e.error),window.eduNetErrorHandler&&window.eduNetErrorHandler.handle(e.error,"Global Error")}),window.addEventListener("unhandledrejection",e=>{console.error("Unhandled promise rejection:",e.reason),window.eduNetErrorHandler&&window.eduNetErrorHandler.handle(e.reason,"Unhandled Promise Rejection")}),console.log("ðŸŽ¯ EduNet19 - Script loaded successfully");