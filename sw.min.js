const CACHE_VERSION=3,CACHE_NAME=`edunet19-v${CACHE_VERSION}`,STATIC_CACHE=`edunet19-static-v${CACHE_VERSION}`,DYNAMIC_CACHE=`edunet19-dynamic-v${CACHE_VERSION}`,SW_PATH=self.location.pathname,BASE_PATH=SW_PATH.endsWith("/sw.js")?SW_PATH.slice(0,-6):SW_PATH.substring(0,SW_PATH.lastIndexOf("/")+1),BASE_URL=""===BASE_PATH?"/":BASE_PATH.endsWith("/")?BASE_PATH:`${BASE_PATH}/`,withBasePath=e=>`${BASE_URL}${e.replace(/^\//,"")}`,STATIC_ASSETS=[BASE_URL,withBasePath("index.html"),withBasePath("homepage.html"),withBasePath("styles.css"),withBasePath("favicon.svg"),withBasePath("favicon.ico")],CACHEABLE_EXTENSIONS=[".css",".js",".png",".jpg",".jpeg",".svg",".ico",".woff",".woff2"];function isCacheableAsset(e){return CACHEABLE_EXTENSIONS.some(t=>e.endsWith(t))}async function networkFirst(e){try{const t=await fetch(e);if(t.ok){const n=await caches.open(DYNAMIC_CACHE);n.put(e,t.clone())}return t}catch(t){const n=await caches.match(e);return n||new Response('<!DOCTYPE html>\n      <html lang="it">\n      <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>EduNet19 - Offline</title>\n        <style>\n          body {\n            font-family: \'Inter\', -apple-system, BlinkMacSystemFont, sans-serif;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            min-height: 100vh;\n            margin: 0;\n            background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%);\n            color: white;\n            text-align: center;\n            padding: 2rem;\n          }\n          .icon { font-size: 4rem; margin-bottom: 1rem; }\n          h1 { margin: 0 0 1rem; font-size: 1.5rem; }\n          p { margin: 0 0 2rem; opacity: 0.8; }\n          button {\n            background: #3b82f6;\n            color: white;\n            border: none;\n            padding: 0.75rem 1.5rem;\n            border-radius: 8px;\n            font-size: 1rem;\n            cursor: pointer;\n          }\n          button:hover { background: #2563eb; }\n        </style>\n      </head>\n      <body>\n        <div class="icon">ðŸ“¡</div>\n        <h1>Sei offline</h1>\n        <p>Controlla la tua connessione internet e riprova.</p>\n        <button onclick="location.reload()">Riprova</button>\n      </body>\n      </html>',{status:503,headers:{"Content-Type":"text/html; charset=utf-8"}})}}async function cacheFirst(e){const t=await caches.match(e);if(t)return fetch(e).then(async t=>{if(t.ok){const n=await caches.open(STATIC_CACHE);n.put(e,t)}}).catch(()=>{}),t;try{const t=await fetch(e);if(t.ok){const n=await caches.open(STATIC_CACHE);n.put(e,t.clone())}return t}catch(e){return new Response("Asset not available offline",{status:503})}}self.addEventListener("install",e=>{console.log("ðŸ“¦ Service Worker: Installing..."),e.waitUntil(caches.open(STATIC_CACHE).then(e=>(console.log("ðŸ“¦ Service Worker: Caching static assets"),Promise.allSettled(STATIC_ASSETS.map(t=>e.add(t).catch(e=>{console.warn(`Could not cache ${t}:`,e.message)}))))).then(()=>(console.log("âœ… Service Worker: Installed"),self.skipWaiting())))}),self.addEventListener("activate",e=>{console.log("ðŸš€ Service Worker: Activating..."),e.waitUntil(caches.keys().then(e=>Promise.all(e.filter(e=>e.startsWith("edunet19-")&&e!==STATIC_CACHE&&e!==DYNAMIC_CACHE).map(e=>(console.log("ðŸ—‘ï¸ Service Worker: Deleting old cache:",e),caches.delete(e))))).then(()=>(console.log("âœ… Service Worker: Activated"),self.clients.claim())))}),self.addEventListener("fetch",e=>{const{request:t}=e,n=new URL(t.url);"GET"===t.method&&(n.hostname.includes("supabase")||n.protocol.startsWith("http")&&(n.search?console.log("ðŸ“¦ SW: Bypassing cache for URL with query params:",n.href):t.headers.get("accept")?.includes("text/html")?e.respondWith(networkFirst(t)):isCacheableAsset(n.pathname)&&e.respondWith(cacheFirst(t))))}),self.addEventListener("message",e=>{"skipWaiting"===e.data&&self.skipWaiting(),"clearCache"===e.data&&caches.keys().then(e=>{e.forEach(e=>{e.startsWith("edunet19-")&&caches.delete(e)})})}),console.log("ðŸ“¦ EduNet19 Service Worker loaded");